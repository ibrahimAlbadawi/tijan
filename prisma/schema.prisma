generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SuperAdmin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model User {
  email              String         @unique
  username           String         @unique
  password           String
  createdAt          DateTime       @default(now())
  address            String?
  firstName          String
  imagePath          String?
  isActive           Boolean        @default(true)
  lastName           String
  nationality        String?
  phoneNumber        String?
  superAdminId       Int?
  updatedAt          DateTime?      @updatedAt
  id                 Int            @id @default(autoincrement())
  role               Role
  doctor             Doctor?
  adminMedicalCenter MedicalCenter? @relation("AdminToCenter")
  receptionist       Receptionist?
  superAdmin         SuperAdmin?    @relation(fields: [superAdminId], references: [id])

  @@index([role])
}

model MedicalCenter {
  id                   Int              @id @default(autoincrement())
  name                 String
  address              String
  phoneNumber          String
  numberOfClinics      Int
  notificationLeadTime Int
  isActive             Boolean          @default(true)
  adminId              Int              @unique
  doctors              Doctor[]
  admin                User             @relation("AdminToCenter", fields: [adminId], references: [id])
  patients             PatientProfile[]
  receptionists        Receptionist[]
}

model Receptionist {
  id              Int           @id @default(autoincrement())
  userId          Int           @unique
  medicalCenterId Int
  medicalCenter   MedicalCenter @relation(fields: [medicalCenterId], references: [id])
  user            User          @relation(fields: [userId], references: [id])
}

model Doctor {
  id              Int           @id @default(autoincrement())
  major           String
  userId          Int           @unique
  medicalCenterId Int
  appointments    Appointment[]
  medicalCenter   MedicalCenter @relation(fields: [medicalCenterId], references: [id])
  user            User          @relation(fields: [userId], references: [id])
}

model PatientProfile {
  id              Int           @id @default(autoincrement())
  firstName       String
  lastName        String
  email           String?
  dateOfBirth     DateTime
  phoneNumber     String?
  gender          String
  nationality     String?
  address         String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime?     @updatedAt
  medicalCenterId Int
  appointments    Appointment[]
  medicalCenter   MedicalCenter @relation(fields: [medicalCenterId], references: [id])
}

model Appointment {
  status                String         @default("confirmed")
  appointmentDateTime   DateTime
  caseDescription       String
  createdAt             DateTime       @default(now())
  doctorId              Int
  followUpAppointmentId Int?
  isDeleted             Boolean        @default(false)
  notificationSent      Boolean        @default(false)
  notifiedAt            DateTime?
  updatedAt             DateTime?      @updatedAt
  id                    Int            @id @default(autoincrement())
  patientId             Int
  doctor                Doctor         @relation(fields: [doctorId], references: [id])
  followUpAppointment   Appointment?   @relation("FollowUp", fields: [followUpAppointmentId], references: [id])
  previousAppointments  Appointment[]  @relation("FollowUp")
  patient               PatientProfile @relation(fields: [patientId], references: [id])
}

enum Role {
  medical_admin
  receptionist
  doctor
  supply_admin
}
